<!DOCTYPE html>
<html>
<head>

<title>NRLM Geo Attendance System</title>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>

body{
  font-family: Arial;
  background:#eef2f7;
  text-align:center;
}

.box{
  background:white;
  padding:20px;
  margin:20px auto;
  border-radius:10px;
  box-shadow:0px 0px 10px #aaa;
  width:90%;
  max-width:700px;
}

input{
  padding:10px;
  margin:5px;
  width:90%;
}

button{
  padding:10px;
  margin:5px;
  width:95%;
  background:#2b7cff;
  color:white;
  border:none;
  border-radius:5px;
  cursor:pointer;
}

button:hover{
  opacity:0.9;
}

.menu button{
  width:auto;
  margin:5px;
}

table{
  width:100%;
  margin-top:10px;
  border-collapse:collapse;
}

th,td{
  padding:8px;
  border:1px solid #ccc;
}

.hide{
  display:none;
}

.logout{
  background:red;
}

.backBtn{
  background:green;
}

#popup{
  position:fixed;
  top:30%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#fff;
  padding:20px;
  border-radius:10px;
  box-shadow:0px 0px 15px #000;
  display:none;
}

.success{ color:green; }
.error{ color:red; }

</style>

</head>

<body>

<h2>NRLM Attendance Portal</h2>

<div id="popup">
  <p id="popMsg"></p>
  <button onclick="$('#popup').hide()">OK</button>
</div>

<!-- LOGIN -->
<div class="box" id="loginBox">
<h3>Login</h3>
<input id="userid" placeholder="User ID">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<!-- MAIN PANEL -->
<div id="mainPanel" class="hide">

<h3>Welcome <span id="uname"></span></h3>

<div class="menu">

<button id="menuLeave" onclick="show('leaveBox')" style="display:none;">Apply Leave</button>

<button id="menuAttendance" onclick="show('attendanceBox')" style="display:none;">
Geo Attendance
</button>

<button id="menuBPM" onclick="show('bpmPanel')" style="display:none;">BPM Approvals</button>

<button id="menuBlock" onclick="show('blockPanel')" style="display:none;">Block Approvals</button>

<button id="menuReports" onclick="show('reportPanel')" style="display:none;">Reports</button>

<button class="logout" onclick="logout()">Logout</button>

</div>

<!-- APPLY LEAVE -->
<div class="box hide" id="leaveBox">
<h3>Apply Leave</h3>
From:<input id="from" type="date">
To:<input id="to" type="date">
Reason:<input id="reason">
<button onclick="applyLeave()">Apply</button>
<button class="backBtn" onclick="backHome()">Back</button>
</div>

<!-- GEO ATTENDANCE -->
<div class="box hide" id="attendanceBox">
<h3>Geo Attendance</h3>
<button onclick="markIn()">Attendance IN</button>
<button onclick="markOut()">Attendance OUT</button>
<button class="backBtn" onclick="backHome()">Back</button>
</div>

<!-- BPM PANEL -->
<div class="box hide" id="bpmPanel">
<h3>BPM – Approvals</h3>
<button onclick="loadLeaves()">Load Leaves</button>
<table id="bpmTable"></table>
<button class="backBtn" onclick="backHome()">Back</button>
</div>

<!-- BLOCK PANEL -->
<div class="box hide" id="blockPanel">
<h3>Block – Final Approvals</h3>
<button onclick="loadLeaves()">Load Leaves</button>
<table id="blockTable"></table>
<button class="backBtn" onclick="backHome()">Back</button>
</div>

<!-- REPORT PANEL -->
<div class="box hide" id="reportPanel">
<h3>Reports</h3>
<button onclick="loadReport()">Load Report</button>
<table id="reportTable"></table>
<button class="backBtn" onclick="backHome()">Back</button>
</div>

</div>

<script>

var URL = "https://script.google.com/macros/s/AKfycbxq6MXKwRRqXhHt61RWEpcd6kXFCV6FzosF7qPIM3_TXpi-C85ZtTp0C9u1E0vo0Fg8HA/exec";

var userid="";
var role="";

function showPopup(msg,type){
  $("#popMsg").html(msg);
  $("#popMsg").attr("class",type);
  $("#popup").show();
}

function login(){
$.post(URL,{
  action:"login",
  userid:$("#userid").val(),
  password:$("#password").val()
},function(res){

var r = JSON.parse(res);

if(r.status=="ok"){
  userid=$("#userid").val();
  role=r.role;

  $("#uname").html(r.name + " ("+r.role+")");
  $("#loginBox").hide();
  $("#mainPanel").show();

  if(role=="CADRE"){
    $("#menuLeave").show();
    $("#menuAttendance").show();
  }
  else if(role=="BPM"){
    $("#menuBPM").show();
  }
  else if(role=="BLOCK"){
    $("#menuBlock").show();
    $("#menuReports").show();
  }

  showPopup("Login Successful","success");
}
else{
  showPopup("Login Failed","error");
}

});
}

function applyLeave(){
$.post(URL,{
  action:"applyLeave",
  userid:userid,
  from:$("#from").val(),
  to:$("#to").val(),
  reason:$("#reason").val()
},function(res){
  showPopup(res,"success");
});
}

function markIn(){
if(!navigator.geolocation){
 showPopup("Geolocation Not Supported","error");
 return;
}

navigator.geolocation.getCurrentPosition(function(p){
$.post(URL,{
  action:"markIn",
  userid:userid,
  lat:p.coords.latitude,
  lon:p.coords.longitude
},function(res){
  showPopup(res,"success");
});
}, function(){
showPopup("Allow Location Permission","error");
});
}

function markOut(){
if(!navigator.geolocation){
 showPopup("Geolocation Not Supported","error");
 return;
}

navigator.geolocation.getCurrentPosition(function(p){
$.post(URL,{
  action:"markOut",
  userid:userid,
  lat:p.coords.latitude,
  lon:p.coords.longitude
},function(res){
  showPopup(res,"success");
});
}, function(){
showPopup("Allow Location Permission","error");
});
}

function show(id){
$(".box").hide();
$("#"+id).show();
}

function backHome(){
$(".box").hide();
}

function logout(){
location.reload();
}

</script>

</body>
</html>


