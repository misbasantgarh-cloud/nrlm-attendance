<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NRLM Geo Attendance & MIS</title>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background:linear-gradient(to right,#eef2ff,#f8fafc);
}
header{
    background:linear-gradient(135deg,#1e3a8a,#2563eb);
    color:white;
    padding:18px;
    text-align:center;
    font-size:22px;
    font-weight:600;
}
.card{
    background:white;
    margin:20px auto;
    padding:25px;
    width:95%;
    max-width:1100px;
    border-radius:15px;
    box-shadow:0 10px 25px rgba(0,0,0,0.08);
}
h3,h4{margin-top:0;color:#1e3a8a}
input{
    padding:12px;
    margin:8px 0;
    width:100%;
    max-width:400px;
    border-radius:8px;
    border:1px solid #cbd5e1;
}
input:focus{
    outline:none;
    border-color:#2563eb;
    box-shadow:0 0 0 2px rgba(37,99,235,0.2);
}
button{
    padding:10px 18px;
    margin:8px 5px 8px 0;
    background:#2563eb;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:500;
}
button:hover{background:#1e40af}
.logout{background:#dc2626}
.hidden{display:none}
.tabs{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:20px}
.tabs button{background:#e2e8f0;color:#1e293b}
.tabs button.activeTab{background:#2563eb;color:white}
.table-container{overflow-x:auto}
table{width:100%;border-collapse:collapse;min-width:600px}
th,td{border:1px solid #e2e8f0;padding:10px;text-align:center;font-size:14px}
th{background:#2563eb;color:white}
.loader{
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(255,255,255,0.7);
    display:flex;justify-content:center;align-items:center;
    z-index:9999;display:none;
}
.spinner{
    border:6px solid #e5e7eb;
    border-top:6px solid #2563eb;
    border-radius:50%;
    width:50px;height:50px;
    animation:spin 1s linear infinite;
}
@keyframes spin{100%{transform:rotate(360deg)}}
.geo-status{margin-top:10px;font-size:14px;color:#16a34a}
@media(max-width:768px){
    button{width:100%;margin:8px 0}
    .tabs button{flex:1}
}
</style>
</head>
<body>

<header>
<i class="fa-solid fa-location-dot"></i> NRLM Geo Attendance & MIS Portal
</header>

<div class="loader" id="loader">
<div class="spinner"></div>
</div>

<!-- LOGIN -->
<div class="card" id="loginCard">
<h3><i class="fa-solid fa-user"></i> Login</h3>
<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
<button onclick="login()"><i class="fa-solid fa-right-to-bracket"></i> Login</button>
</div>

<!-- DASHBOARD -->
<div class="card hidden" id="dashboard">
<h3 id="welcome"></h3>
<button class="logout" onclick="logout()"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>

<div class="tabs" id="tabs"></div>

<div id="attendanceTab" class="hidden">
<h4>Mark Attendance</h4>
<button onclick="markAttendance()">Mark Attendance</button>
<div class="geo-status" id="geoStatus"></div>
</div>

<div id="leaveTab" class="hidden">
<h4>Apply Leave</h4>
<input type="date" id="fromDate">
<input type="date" id="toDate">
<input type="text" id="reason" placeholder="Reason">
<button onclick="applyLeave()">Submit Leave</button>
</div>

</div>

<!-- ===== POPUP MODAL ===== -->
<div id="popupModal" style="
display:none;
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:rgba(0,0,0,0.4);
justify-content:center;
align-items:center;
z-index:10000;">
  
  <div style="
  background:white;
  padding:25px;
  border-radius:12px;
  width:90%;
  max-width:400px;
  text-align:center;
  box-shadow:0 10px 25px rgba(0,0,0,0.2);">
    
    <p id="popupMessage" style="margin-bottom:20px;font-weight:500;"></p>
    
    <button onclick="closePopup()" 
    style="padding:8px 20px;border-radius:6px;border:none;background:#2563eb;color:white;">
      OK
    </button>
  </div>
</div>

<script>

const API="<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NRLM Geo Attendance & MIS</title>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background:linear-gradient(to right,#eef2ff,#f8fafc);
}
header{
    background:linear-gradient(135deg,#1e3a8a,#2563eb);
    color:white;
    padding:18px;
    text-align:center;
    font-size:22px;
    font-weight:600;
}
.card{
    background:white;
    margin:20px auto;
    padding:25px;
    width:95%;
    max-width:1100px;
    border-radius:15px;
    box-shadow:0 10px 25px rgba(0,0,0,0.08);
}
h3,h4{margin-top:0;color:#1e3a8a}
input{
    padding:12px;
    margin:8px 0;
    width:100%;
    max-width:400px;
    border-radius:8px;
    border:1px solid #cbd5e1;
}
input:focus{
    outline:none;
    border-color:#2563eb;
    box-shadow:0 0 0 2px rgba(37,99,235,0.2);
}
button{
    padding:10px 18px;
    margin:8px 5px 8px 0;
    background:#2563eb;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:500;
}
button:hover{background:#1e40af}
.logout{background:#dc2626}
.hidden{display:none}
.tabs{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:20px}
.tabs button{background:#e2e8f0;color:#1e293b}
.tabs button.activeTab{background:#2563eb;color:white}
.table-container{overflow-x:auto}
table{width:100%;border-collapse:collapse;min-width:600px}
th,td{border:1px solid #e2e8f0;padding:10px;text-align:center;font-size:14px}
th{background:#2563eb;color:white}
.loader{
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(255,255,255,0.7);
    display:flex;justify-content:center;align-items:center;
    z-index:9999;display:none;
}
.spinner{
    border:6px solid #e5e7eb;
    border-top:6px solid #2563eb;
    border-radius:50%;
    width:50px;height:50px;
    animation:spin 1s linear infinite;
}
@keyframes spin{100%{transform:rotate(360deg)}}
.geo-status{margin-top:10px;font-size:14px;color:#16a34a}
@media(max-width:768px){
    button{width:100%;margin:8px 0}
    .tabs button{flex:1}
}
</style>
</head>
<body>

<header>
<i class="fa-solid fa-location-dot"></i> NRLM Geo Attendance & MIS Portal
</header>

<div class="loader" id="loader">
<div class="spinner"></div>
</div>

<!-- LOGIN -->
<div class="card" id="loginCard">
<h3><i class="fa-solid fa-user"></i> Login</h3>
<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
<button onclick="login()"><i class="fa-solid fa-right-to-bracket"></i> Login</button>
</div>

<!-- DASHBOARD -->
<div class="card hidden" id="dashboard">
<h3 id="welcome"></h3>
<button class="logout" onclick="logout()"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>

<div class="tabs" id="tabs"></div>

<div id="attendanceTab" class="hidden">
<h4>Mark Attendance</h4>
<button onclick="markAttendance()">Mark Attendance</button>
<div class="geo-status" id="geoStatus"></div>
</div>

<div id="leaveTab" class="hidden">
<h4>Apply Leave</h4>
<input type="date" id="fromDate">
<input type="date" id="toDate">
<input type="text" id="reason" placeholder="Reason">
<button onclick="applyLeave()">Submit Leave</button>
</div>

</div>

<!-- ===== POPUP MODAL ===== -->
<div id="popupModal" style="
display:none;
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:rgba(0,0,0,0.4);
justify-content:center;
align-items:center;
z-index:10000;">
  
  <div style="
  background:white;
  padding:25px;
  border-radius:12px;
  width:90%;
  max-width:400px;
  text-align:center;
  box-shadow:0 10px 25px rgba(0,0,0,0.2);">
    
    <p id="popupMessage" style="margin-bottom:20px;font-weight:500;"></p>
    
    <button onclick="closePopup()" 
    style="padding:8px 20px;border-radius:6px;border:none;background:#2563eb;color:white;">
      OK
    </button>
  </div>
</div>

<script>

const API="YOUR_WEB_APP_URL_HERE";
let userRole="",userBlock="",userName="";

/* ===== POPUP ===== */
function showPopup(message){
  document.getElementById("popupMessage").innerText = message;
  document.getElementById("popupModal").style.display = "flex";
}
function closePopup(){
  document.getElementById("popupModal").style.display = "none";
}

/* LOGIN */
function login(){
fetch(API,{
  method:"POST",
  body:JSON.stringify({action:"login",username:username.value,password:password.value})
}).then(r=>r.json()).then(res=>{
  if(res.status==="success"){
    userRole=res.role; userBlock=res.block; userName=username.value;
    showDashboard();
  } else {
    showPopup(res.message);
  }
});
}

function logout(){ location.reload(); }

/* ATTENDANCE */
function markAttendance(){
navigator.geolocation.getCurrentPosition(function(pos){
fetch(API,{
method:"POST",
body:JSON.stringify({action:"markAttendance",name:userName,role:userRole,block:userBlock,
latitude:pos.coords.latitude,longitude:pos.coords.longitude})
}).then(r=>r.json()).then(res=>{
showPopup(res.message || "Attendance Submitted");
});
});
}

/* LEAVE */
function applyLeave(){
fetch(API,{
method:"POST",
body:JSON.stringify({action:"applyLeave",name:userName,block:userBlock,
from:fromDate.value,to:toDate.value,reason:reason.value})
}).then(r=>r.json()).then(res=>{
showPopup(res.message || "Leave Submitted");
});
}

/* GEO STATUS */
navigator.geolocation.getCurrentPosition(
()=>{document.getElementById("geoStatus").innerHTML="GPS Ready";},
()=>{document.getElementById("geoStatus").innerHTML="GPS Not Enabled";}
);

</script>
</body>
</html>
";
let userRole="",userBlock="",userName="";

/* ===== POPUP ===== */
function showPopup(message){
  document.getElementById("popupMessage").innerText = message;
  document.getElementById("popupModal").style.display = "flex";
}
function closePopup(){
  document.getElementById("popupModal").style.display = "none";
}

/* LOGIN */
function login(){
fetch(API,{
  method:"POST",
  body:JSON.stringify({action:"login",username:username.value,password:password.value})
}).then(r=>r.json()).then(res=>{
  if(res.status==="success"){
    userRole=res.role; userBlock=res.block; userName=username.value;
    showDashboard();
  } else {
    showPopup(res.message);
  }
});
}

function logout(){ location.reload(); }

/* ATTENDANCE */
function markAttendance(){
navigator.geolocation.getCurrentPosition(function(pos){
fetch(API,{
method:"POST",
body:JSON.stringify({action:"markAttendance",name:userName,role:userRole,block:userBlock,
latitude:pos.coords.latitude,longitude:pos.coords.longitude})
}).then(r=>r.json()).then(res=>{
showPopup(res.message || "Attendance Submitted");
});
});
}

/* LEAVE */
function applyLeave(){
fetch(API,{
method:"POST",
body:JSON.stringify({action:"applyLeave",name:userName,block:userBlock,
from:fromDate.value,to:toDate.value,reason:reason.value})
}).then(r=>r.json()).then(res=>{
showPopup(res.message || "Leave Submitted");
});
}

/* GEO STATUS */
navigator.geolocation.getCurrentPosition(
()=>{document.getElementById("geoStatus").innerHTML="GPS Ready";},
()=>{document.getElementById("geoStatus").innerHTML="GPS Not Enabled";}
);

</script>
</body>
</html>
