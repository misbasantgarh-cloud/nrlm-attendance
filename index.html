<!DOCTYPE html>
<html>
<head>
<title>NRLM Geo Attendance</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
body{font-family:Arial;background:#eef2f7;text-align:center}
.box{background:white;padding:20px;margin:20px auto;border-radius:10px;
box-shadow:0px 0px 10px #aaa;width:90%;max-width:600px}
input{padding:10px;margin:5px;width:90%}
button{padding:10px;margin:5px;width:95%;background:#2b7cff;color:white;border:none;border-radius:5px}
.hide{display:none}
.logout{background:red}
.success{color:green}
.error{color:red}
</style>
</head>

<body>

<h2>NRLM Geo Attendance Portal</h2>

<div id="loginBox" class="box">
<h3>Login</h3>
<input id="userid" placeholder="User ID">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<p id="msg"></p>
</div>

<div id="mainPanel" class="hide">

<div class="box">
<h3>Welcome <span id="uname"></span></h3>
<button onclick="markIn()">Mark IN</button>
<button onclick="markOut()">Mark OUT</button>
<button onclick="showLeave()">Apply Leave</button>
<button class="logout" onclick="logout()">Logout</button>
</div>

<div class="box hide" id="leaveBox">
<h3>Apply Leave</h3>
From:<input type="date" id="from">
To:<input type="date" id="to">
Reason:<input id="reason">
<button onclick="applyLeave()">Submit</button>
<button onclick="$('#leaveBox').hide()">Back</button>
</div>

</div>

<script>

var URL="https://script.google.com/macros/s/AKfycbxRddq72DaY_bsZQlsDfkpWdgWRtP8laBIm4-Zh2UFgMPfKn9AKj_NuILRg-XKl95T9PQ/exec";
var userid="";

function showMsg(msg,type){
$("#msg").html(msg).removeClass().addClass(type);
}

function login(){

$.post(URL,{
action:"login",
userid:$("#userid").val(),
password:$("#password").val()
},function(res){

if(res.status=="ok"){
userid=$("#userid").val();
$("#uname").text(res.name+" ("+res.role+")");
$("#loginBox").hide();
$("#mainPanel").show();
}else{
showMsg("Invalid Login","error");
}

},"json");
}

function markIn(){

navigator.geolocation.getCurrentPosition(function(pos){

$.post(URL,{
action:"markIn",
userid:userid,
lat:pos.coords.latitude,
lon:pos.coords.longitude
},function(res){
alert(res.message);
},"json");

});
}

function markOut(){

navigator.geolocation.getCurrentPosition(function(pos){

$.post(URL,{
action:"markOut",
userid:userid,
lat:pos.coords.latitude,
lon:pos.coords.longitude
},function(res){
alert(res.message);
},"json");

});
}

function showLeave(){
$("#leaveBox").show();
}

function applyLeave(){

$.post(URL,{
action:"applyLeave",
userid:userid,
from:$("#from").val(),
to:$("#to").val(),
reason:$("#reason").val()
},function(res){
alert(res.message);
},"json");

}

function logout(){
location.reload();
}

</script>

</body>
</html>
